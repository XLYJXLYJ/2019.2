<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="../../css/robot.css"/>
	</head>
	<body>
		<div class="mainCont hide">
			<div class="mainDiv">
				<img src="../../img/X.png" class="closeBtn" />
				<div class="closeDiv">
					<div class="closeFix"></div>
					<div class="closeCont">
						<textarea class="evaluateTxt"  name="" maxlength="200" cols="" placeholder="留下您的建议~" onkeyup="this.value = this.value.slice(0, 200)"></textarea>
						<p class="wrongTip"></p>
						<input type="button" name="" value="评价" class="evaluate"/>
						<input type="button" name="" value="暂不评价" class="evaluateNo"/>
						<input type="button" name="" value="返回聊天" class="back"/>
					</div>
				</div>
				<div class="mainTitle clear">
					<div class="mainTitleCont">
						<p class="titleContTop">AIMI</p>
						<p>智能风险官</p>
					</div>
				</div>
				<div class="mainPart">
					<div class="tipTxt">
						<div class="tipTxtCont">快现发布保险需求，获取报价>>　<a href="javascript:;" class="linkTxt">立即采购比价</a></div>
						<a class="toChat" href="tencent://message/?uin=3483651798&amp;Site=&amp;menu=yes">转人工客服</a>
					</div>
					<ul class="contPart1">
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>嘿哈，我就是智能风险官Aimi，很高兴为您服务：</p>
									<ul class="insuranceCont">
										<li>1.输入“保不保”，轻松了解标的风险的保障情况。</li>
										<li>2.输入“查询”，可快速查询保单详细信息。</li>
										<li>3.输入“批单”、“理赔”、“续保”，可快速进行保单业务操作。</li>
										<li>4.风险官问答，快速了解企业风险及方案建议。</li>
									</ul>
								</div>
							</div>
						</li>
						<li class="liRight clear">
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>我想知道企保科技是一家什么样的公司？</p>
								</div>
							</div>
						</li>
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<div class="liTipPic"></div>
									<div class="liTipPic2"></div>
									<p class="questionTitle">请问您的企业经营规模是如下哪一种？（请选择）</p>
									<div class="questionCont clear">
										<label data-type="A">
											<input type="radio" name="guimo" />
											<span>A.3000万以下</span>
										</label>
										<label data-type="B">
											<input type="radio" name="guimo" />
											<span>B.3000万-1亿</span>
										</label>
										<label data-type="C">
											<input type="radio" name="guimo" />
											<span>C.1亿-10亿</span>
										</label>
										<label data-type="D">
											<input type="radio" name="guimo" />
											<span>D.10亿以上</span>
										</label>
										<label data-type="E">
											<input type="radio" name="guimo" />
											<span>E.以上都不是</span>
										</label>
									</div>
								</div>
							</div>	
						</li>
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>您的保单详情如下：</p>
									<ul class="insuranceCont">
										<li>险种：XXX</li>
										<li>承保公司：XXX</li>
										<li>保费：￥XXX</li>
										<li>到期日：2018-6-25</li>
										<li>保单号：<a href="javascript:;" class="linkTxt">xxxxxxxx</a></li>
									</ul>
								</div>
							</div>
						</li>
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>您的保单如下：</p>
									<ul class="insuranceCont insurance_ul">
										<li>险种：XXX</li>
										<li>承保公司：XXX</li>
										<li>保费：￥XXX</li>
										<li>到期日：2018-6-25</li>
										<li>保单号：<a href="javascript:;" class="linkTxt" >xxxxxxxx</a></li>
									</ul>
									<ul class="insuranceCont insurance_ul">
										<li>险种：XXX</li>
										<li>承保公司：XXX</li>
										<li>保费：￥XXX</li>
										<li>到期日：2018-6-25</li>
										<li>保单号：<a href="javascript:;" class="linkTxt" >xxxxxxxx</a></li>
									</ul>
									<p class="txtTip">点击保单号，即可查看详情。</p>
								</div>
							</div>	
						</li>
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>经过Aimi的认真查询，您在系统内暂无保单。</p>
								</div>
								<div class="containAsk clear">
									<div class="askNo">
										<div class="askPic"></div>
										<span>未解决</span>
									</div>
									<div class="askYes">
										<div class="askPic"></div>
										<span>已解决</span>
									</div>
								</div>
							</div>
						</li>
						<li class="liLeft clear">
							<p class="liTxtTile">Aimi</p>
							<div class="liDivTxt">
								<div class="liTxtCont">
									<p>您的保单如下：</p>
									<ul class="insuranceCont">
										<li>险种：XXX</li>
										<li>承保公司：XXX</li>
										<li>保费：￥XXX</li>
										<li>到期日：2018-6-25</li>
										<li>保单号：<a href="javascript:;" class="linkTxt" >xxxxxxxx</a></li>
									</ul>
									<p class="txtTip">点击保单号，即可查看详情。</p>
								</div>
								<div class="containAsk clear">
									<div class="askNo">
										<div class="askPic"></div>
										<span>未解决</span>
									</div>
									<div class="askYes">
										<div class="askPic"></div>
										<span>已解决</span>
									</div>
								</div>
							</div>	
						</li>
					</ul>
					<div class="contPart2">
						<div class="divContain">
							<textarea class="contPart2Txt" name="" maxlength="200" cols="" placeholder="专业源于您耐心的提问" onkeyup="this.value = this.value.slice(0, 200)"></textarea>
						</div>
						<div class="contPart2Btn unsendMsg">发送</div>
					</div>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/placeholder.js"></script>	
	<script type="text/javascript" src="../../layer/layer.js"></script>
	<script type="text/javascript" >
		String.prototype.trim = function () {
			return this .replace(/^\s\s*/, '' ).replace(/\s\s*$/, '' );
		};
			
		var hostArr = document.domain.split('.');
        var p2 = hostArr.pop();
        var p1 = hostArr.pop();
//      document.domain = p1 + '.' + p2;
		$(".contPart2Txt").focus().val("");
        // 弹出 对话框
        parent.$(".robotBtn").on("click",function () {
            $(".contPart2Txt").val("1");
            setTimeout(function () {
                $(".contPart2Txt").focus().val("");
            })
            $(".contPart2Btn").addClass("unsendMsg").removeClass("sendMsg");;
        });

        // 点击对话框的 关闭按钮
        $(document).on("click", ".closeBtn", function () {
            $(".evaluateTxt").val("");
            $(".closeDiv").css({display: "block"});
            $(".closeFix").css({visibility: "visible"});
            $(".wrongTip").html("");
        });

        // 关闭 对话框函数
        var closeMain = function () {
            parent.$(".robotBtn").addClass("robotBtn1").removeClass("robotBtn2");
            parent.layer.closeAll();
        };

        // 点击 暂不评价
        $(document).on("click", ".evaluateNo", function () {
            closeMain();
        });
        
        //点击返回聊天
        $(document).on("click",".back",function(){
        	$(".closeDiv").hide();
        	$(".contPart2Txt").focus();
        });
        
        // 点击 评价
        $(document).on("click", ".evaluate", function () {
            var evaluateTxt = $(".evaluateTxt");
            if (evaluateTxt.val().trim()) {
                $.post("http://www.dev.qibaozz.com/aimi/feedback", {'content': $.trim(evaluateTxt.val())}, function (data) {
                }, 'json');
                closeMain();
            } else {
                $(".wrongTip").html("请输入评价内容");
            }

        });
        $(".evaluateTxt").blur(function () {
            if ($.trim($(this).val())) {
                $(".wrongTip").html("");
            }
        });

        // 转人工服务
        $(document).on("click", ".toChat", function () {
            parent.$(".layui-layer").animate({right: -496}, 500);
            parent.$(".robotBtn").addClass("robotBtn3").removeClass("robotBtn2");
        });

        // 监控输入框内容
        $(".contPart2Txt").bind('input propertychange', function () {
            if ($.trim($(this).val())) {
                $(".contPart2Btn").addClass("sendMsg").removeClass("unsendMsg");
            } else {
                $(".contPart2Btn").addClass("unsendMsg").removeClass("sendMsg");
            }
        });

        // 发送信息函数
        var sendMsg = function () {
            $(".contPart2Txt").focus();
            var contTxt = $(".contPart1");
            var textInpt = $(".contPart2Txt");
            var msg = textInpt.val().trim();
            if (msg) {
                var liRightHtml = '<li class="liRight clear">\
                						<div class="liDivTxt">\
                                        	<div class="liTxtCont">' + textInpt.val().replace(/[\r\n]/g,"") + '</div>\
                                        </div>\
                                    </li>';
                contTxt.append(liRightHtml);
                var scrollHeight = contTxt[0].scrollHeight;
                contTxt.scrollTop(scrollHeight);
                textInpt.val("");
            }
            $(".contPart2Btn").addClass("unsendMsg").removeClass("sendMsg");
            if(msg){
                $.post("http://www.dev.qibaozz.com/aimi/message", {'msg': msg}, function (data) {
                    contTxt.append(data.data.msg);
                    var scrollHeight = contTxt[0].scrollHeight;
                    contTxt.scrollTop(scrollHeight + 100);
                }, 'json');
            }
        };
        // 点击 发送
        $(document).on("click", ".contPart2Btn", function () {
            sendMsg();
        });
        $(document).keyup(function (e) {
            if(e.keyCode == 13) {
                var val=$(".contPart2Txt").val();
//              var val=$(".contPart2Txt").val($(".contPart2Txt").val().replace(/[\r\n]/g,""));
                if(val!=""){
                    sendMsg();
                };
            }
        });

        // 点击 解决或未解决
        $(document).on("click", ".askNo", function () {
            var siblingDiv = $(this).siblings("div");
            var id = $(this).parent().data('id');
            if(siblingDiv.find(".askPic").hasClass("clickYes")){
                return false;
            } else {
                var isActive = $(this).find(".askPic").hasClass("clickNo") ? 'yes' : "no";
                $(this).css({color:"#fff"}).find(".askPic").addClass("clickNo");
                siblingDiv.find(".askPic").removeClass("clickYes");
                siblingDiv.css({cursor:"not-allowed"});
                if('no' == isActive){
                   $.post("http://www.dev.qibaozz.com/aimi/solve", {'is_solve': 2,'id':id}, function (data) {}, 'json');
                }
            }

        });
        $(document).on("click", ".askYes", function () {
            var siblingDiv = $(this).siblings("div");
            var id = $(this).parent().data('id');
            if(siblingDiv.find(".askPic").hasClass("clickNo")){
                return false;
            } else {
                var isActive = $(this).find(".askPic").hasClass("clickYes") ? 'yes' : "no";
                $(this).css({color:"#fff"}).find(".askPic").addClass("clickYes");
                siblingDiv.find(".askPic").removeClass("clickNo");
                siblingDiv.css({cursor:"not-allowed"});
                if('no' == isActive){
                   $.post("http://www.dev.qibaozz.com/aimi/solve", {'is_solve': 1,'id':id}, function (data) {}, 'json');
                }
            }
        });
        
        // 选择答案
        $(document).on("click",".questionCont input",function(){
        	var types = $(this).parent().data("type");
        	$(".contPart2Txt").val(types);
        	sendMsg();
        })
	</script>	
</html>
